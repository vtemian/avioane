// Generated by CoffeeScript 1.3.1
(function() {
  var Battle;

  Battle = (function() {

    Battle.name = 'Battle';

    function Battle(opts) {
      this.squareHeight = opts.squareHeight;
      this.gameHolder = opts.gameHolder;
      this.canvasWidth = this.squareHeight * 10 * 2 + this.squareHeight * 2;
      this.canvasHeight = this.squareHeight * 10 + 5 * this.squareHeight;
      this.map = null;
      this.collissions = null;
      this.frontend = null;
    }

    Battle.prototype.createMap = function(top, left, width, height) {
      var context, mapCanvas;
      mapCanvas = document.createElement('canvas');
      mapCanvas.width = width;
      mapCanvas.height = height;
      this.gameHolder.append(mapCanvas);
      context = mapCanvas.getContext('2d');
      this.map = new Map({
        'context': context,
        'position': {
          'top': top,
          'left': left
        },
        'squareHeight': this.squareHeight
      });
      return mapCanvas;
    };

    Battle.prototype.createCollissions = function(frontend) {
      var collissionsCanvas, context;
      collissionsCanvas = document.createElement('canvas');
      collissionsCanvas.width = this.canvasWidth;
      collissionsCanvas.height = this.canvasHeight;
      this.gameHolder.append(collissionsCanvas);
      context = collissionsCanvas.getContext('2d');
      this.collissions = new Collissions({
        'holder': this.map,
        'context': context,
        'canvas': collissionsCanvas
      });
      frontend.collissions = this.collissions;
      collissionsCanvas.onmousedown = function(e) {
        return frontend.checkMouseDown(e);
      };
      collissionsCanvas.onmousemove = function(e) {
        return frontend.checkMouseMove(e);
      };
      return collissionsCanvas.onmouseup = function(e) {
        return frontend.checkMouseUp(e);
      };
    };

    Battle.prototype.createPlanes = function(maxPlaneNumber) {
      var context, order, plane, planeCanvas, _i, _ref, _results;
      _results = [];
      for (order = _i = 0, _ref = maxPlaneNumber - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; order = 0 <= _ref ? ++_i : --_i) {
        planeCanvas = document.createElement('canvas');
        planeCanvas.width = this.canvasWidth;
        planeCanvas.height = this.canvasHeight;
        this.gameHolder.append(planeCanvas);
        context = planeCanvas.getContext('2d');
        plane = new Plane({
          'context': context,
          'position': {
            'top': this.squareHeight * 11,
            'left': this.squareHeight * 5 * order
          },
          'squareHeight': this.squareHeight,
          'droppingArea': this.map,
          'order': order
        });
        _results.push(this.frontend.addPlane(plane));
      }
      return _results;
    };

    Battle.prototype.checkReady = function() {
      console.log(this.checkPlanes());
      if (this.checkPlanes()) {
        return this.createMap(0, this.canvasWidth, 2 * this.canvasWidth, this.canvasHeight);
      } else {
        return false;
      }
    };

    Battle.prototype.checkPlanes = function() {
      var plane, _i, _len, _ref;
      _ref = this.frontend.planes;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        plane = _ref[_i];
        if (plane.isNotReady) {
          return false;
        }
      }
      return true;
    };

    Battle.prototype.init = function() {
      this.createMap(0, 0, this.canvasWidth, this.canvasHeight);
      this.frontend = new Frontend(this.map);
      this.createPlanes(3);
      return this.createCollissions(this.frontend);
    };

    return Battle;

  })();

  window.Battle = Battle;

}).call(this);
